<html>
	<head>
		<meta charset="utf-8" />
	</head>
	<body></body>
	<script src="https://tixit.me/PluginTester.umd.js"></script>
	<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="by8mb3vsys1a607"></script>

	<script>
		registerPlugin(proto(Gem, function(){
			this.name = 'DropboxIntegration'

			this.initialize = function(options){
				return {
					nameField: 'name',
					linkField: 'link'
				}
			}
			this.requireFields = function(options){
				var ticketFields = {}
				ticketFields[options.nameField] = {type: 'text', required: true}
				ticketFields[options.linkField] = {type: 'text', required: true}
				return ticketFields
			}

			this.build = function(ticket, optionsObservee, api){
				// change to table so can display name and link
				var filesContainer = List()
				var buttonOptions = {
					success: function(files){
						console.log('files ', files)
						files.forEach(function(file){
							filesContainer.item(file.link)
						})
					},
					cancel: function(){

					},
					linkType: 'preview',
					multiselect: true,
					folderSelect: true			
				}
				var button = Button()
				button.domNode = Dropbox.createChooseButton(buttonOptions)

				this.add(button, filesContainer)
			}
		}))

		PluginTester.Api.Ticket.create().then(function(testTicket){

			PluginTester('DropboxIntegration', {}, {ticketId: testTicket.subject._id, showEditor: true})
		}).done()
   	</script>
</html>